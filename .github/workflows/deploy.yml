name: Publish and Flush
on:
  push:
    branches: ["main"]
concurrency:
  group: "pages" 
  cancel-in-progress: false
jobs:
    build:
        runs-on: ubuntu-latest
        permissions:
            # Give the default GITHUB_TOKEN write permission to commit and push the
            # added or changed files to the repository.
            contents: write
        steps:
            - uses: actions/checkout@v3
            - name: Cache Hugo resources üìö
              uses: actions/cache@v3
              env:
                  cache-name: cache-hugo-resources
              with:
                  path: resources
                  key: ${{ env.cache-name }}
            - uses: actions/setup-go@v4
              with:
                  go-version: "^1.17.0"
            - run: go version
            - name: Setup Hugo üîß
              uses: peaceiris/actions-hugo@v2
              with:
                  hugo-version: "latest"
                  extended: true
            - name: Build ‚öôÔ∏è
              run: hugo --minify --gc
            - name: Deploy üöÄ
              uses: JamesIves/github-pages-deploy-action@v4
              with:
                  branch: gh-pages
                  folder: public
                  clean: true
                  single-commit: true

      # - name: Delete Build Artifact
        # uses: joutvhu/delete-artifact@v2.0.1
        # with:
          # owner: mysrcs # optional Default is current owner.
          # repo: mysrcs.github.io # optional Default is current repository.
          # run-id: build # optional If github-token is specified, this is the run that artifacts will be deleted from.
          # token: # optional If this is not specified, the action will attempt to delete artifacts from the current repository and the current workflow run.
          # latest: # optional In the case of reruns, this can be useful to avoid duplicates
          # name: github-pages # optional The artifact to delete, multiple names can be supplied on new lines.
          # pattern: # optional A glob pattern matching the artifacts that should be deleted. Ignored if name is specified.

  # Delete workflows
    del_runs:
        runs-on: ubuntu-latest
        needs: build
        permissions:
            actions: write
            contents: read
        steps:
            - name: Delete workflow runs üßπ
              uses: Rubber1Duck/delete-old-workflow-runs@v0.4.0
              with:
                  repository: mysrcs/hugooooo   # replace this with your own repository
                  older-than-seconds: 100             # remove all workflow runs older than 1 day ( default 86400 )
              env:
                 GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
